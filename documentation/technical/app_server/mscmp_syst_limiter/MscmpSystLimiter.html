<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.1">
    <meta name="project" content="mscmp_syst_limiter v0.1.0">

    <title>MscmpSystLimiter â€” mscmp_syst_limiter v0.1.0</title>
    <link rel="stylesheet" href="dist/html-elixir-V2ETBPMB.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-IV5W3OL2.js"></script>
    <script src="dist/sidebar_items-22884E6C.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-XN2TSG4M.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

    <div class="sidebar-projectDetails">
      <a href="MscmpSystLimiter.html" class="sidebar-projectName" translate="no">
mscmp_syst_limiter
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.1.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


  <span translate="no">MscmpSystLimiter</span> 
  <small class="app-vsn" translate="no">(mscmp_syst_limiter v0.1.0)</small>

</h1>


  <section id="moduledoc">
<h1>MscmpSystLimiter - Token Bucket Rate Limiting</h1><p>API for establishing rate limits for usage of finite system resources.</p><p>Online, multi-user systems can be unintentionally overwhelmed by aggressive
service calls from external applications and systems or intentionally
exploited by hostile actors seeking to defeat system protections though such
actions as brute forcing user credentials or consuming all available computing
resources of our application.  One approach to mitigating the dangers of
resource exhaustion or persistent illicit information seeking attempts is to
reject excessive calls to system services.</p><p>This component limits the rate at which targeted services can be called by
any one caller to a level which preserves the availability of resources to
all users of the system, or makes brute force information gathering
prohibitively time intensive to would be attackers of the system.</p><h2 id="module-third-party-functionality" class="section-heading">
  <a href="#module-third-party-functionality" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">third-party-functionality</p>
  </a>
  Third Party Functionality
</h2>
<p>This version of the <a href="MscmpSystLimiter.html#content"><code class="inline">MscmpSystLimiter</code></a> component is primarily a wrapper
around the third party <a href="https://github.com/ExHammer/hammer"><code class="inline">Hammer</code></a> and
<a href="https://github.com/ExHammer/hammer-backend-mnesia"><code class="inline">Hammer.Backend.Mnesia</code></a>
libraries.  <a href="MscmpSystLimiter.html#content"><code class="inline">MscmpSystLimiter</code></a> offers a slightly different API to the
wrapped libraries and changes some return values to be more consistent with
the Muse Systems Business Management System standards and practices.  We also
reuse and incorporate some of the documentation from these projects into our
own documentation as appropriate.</p><h2 id="module-concepts" class="section-heading">
  <a href="#module-concepts" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">concepts</p>
  </a>
  Concepts
</h2>
<p>MscmpSystLimiter implements a <a href="https://en.wikipedia.org/wiki/Token_bucket">&quot;Token Bucket&quot;</a>
rate limiting algorithm.  In a Token Bucket rate limit, for each user and
request type a &quot;bucket&quot;, called a &quot;Counter&quot; herein, with a finite
number of tokens is created.  As requests are made the Counter is checked to
see if all the tokens are consumed and if not the request is allowed and a
token consumed.  If there are no tokens available at request time, then the
request is denied until the Counter expires.</p><p>Over time, expired Counters are periodically deleted by the system.  Both the
expiry time and the cleanup schedule are configurable.</p><h2 id="module-setup-for-use" class="section-heading">
  <a href="#module-setup-for-use" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">setup-for-use</p>
  </a>
  Setup for Use
</h2>
<p>Using this component assumes certain setups and configurations are performed
by the client application:</p><ol><li><p><strong>Setup Mnesia</strong> - MscmpSystLimiter keeps its counters in the Mnesia
database allowing for distribution of the rate limit counters across nodes.
MscmpSystLimiter expects the client application to have setup and called
<a href="https://www.erlang.org/doc/man/mnesia.html#create_schema-1"><code class="inline">:mnesia.create_schema/1</code></a> prior to trying to use the provided services.</p></li><li><p><strong>Initialize the Counter Table</strong> - Once the Mnesia is configured and
running, the Mnesia table which will hold the counters must be created if it
doesn't already exist.  There are two ways to do this: 1) add a start phase to
the client application <code class="inline">mix.exs</code> or call a function which creates the Mnesia
table if it doesn't exist.</p></li></ol><ul><li><strong>Add a Start Phase</strong> - In the <code class="inline">mix.exs</code> applications specification
section add a <code class="inline">:post_mnesia_setup</code> start phase.  Example:</li></ul><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kd">def</span><span class="w"> </span><span class="nf">application</span><span class="w"> </span><span class="k" data-group-id="2757561227-1">do</span><span class="w">
    </span><span class="p" data-group-id="2757561227-2">[</span><span class="w">
      </span><span class="ss">extra_applications</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2757561227-3">[</span><span class="ss">:logger</span><span class="p">,</span><span class="w"> </span><span class="ss">:mnesia</span><span class="p" data-group-id="2757561227-3">]</span><span class="w">
      </span><span class="ss">start_phases</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2757561227-4">[</span><span class="p" data-group-id="2757561227-5">{</span><span class="ss">:post_mnesia_setup</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2757561227-6">[</span><span class="ss">mnesia_table_args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2757561227-7">[</span><span class="p" data-group-id="2757561227-7">]</span><span class="p" data-group-id="2757561227-6">]</span><span class="p" data-group-id="2757561227-5">}</span><span class="p" data-group-id="2757561227-4">]</span><span class="w">
    </span><span class="p" data-group-id="2757561227-2">]</span><span class="w">
  </span><span class="k" data-group-id="2757561227-1">end</span></code></pre><p>  note that an optional <code class="inline">mnesia_table_args</code> value may be set to further
  configure behavior of the mnesia table. <code class="inline">mnesia_table_args</code> is a
  Keyword List which simply gets passed to <a href="https://www.erlang.org/doc/man/mnesia.html#create_table-2"><code class="inline">:mnesia.create_table/2</code></a> as the
  <code class="inline">Arg</code> parameter.  see <a href="https://www.erlang.org/doc/man/mnesia.html#create_table-2">the Erlang docs</a>
  for more.</p><ul><li><strong>Call Table Creation Function</strong> - If adding a <code class="inline">start_phases</code> definition
to the application specification is not desirable, the table creation can
also be completed by explicitly calling
<code class="inline">MscmpSystLimiter.init_rate_limiter/1</code> function.</li></ul>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>
<div class="summary-rate-limiter summary">
  <h2>
    <a href="#rate-limiter">Rate Limiter</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#check_rate/4" translate="no">check_rate(counter_type, counter_id, scale_ms, limit)</a>

      </div>

        <div class="summary-synopsis"><p>Checks if a Counter is within it's permissible rate and increments the Counter
if it is within it's permissible rate.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#check_rate_with_increment/5" translate="no">check_rate_with_increment(counter_type, counter_id, scale_ms, limit, increment)</a>

      </div>

        <div class="summary-synopsis"><p>Checks the rate same as <a href="#check_rate/4"><code class="inline">MscmpSystLimiter.check_rate/4</code></a>, but allows for a
variable increment to be set for the call.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_counters/2" translate="no">delete_counters(counter_type, counter_id)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes a counter from the system.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_check_rate_function/3" translate="no">get_check_rate_function(counter_type, scale_ms, limit)</a>

      </div>

        <div class="summary-synopsis"><p>Returns an anonymous function to simplify calls to check the rate for a
specific counter type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_counter_name/2" translate="no">get_counter_name(counter_type, counter_id)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a canonical name for each unique counter.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#inspect_counter/4" translate="no">inspect_counter(counter_type, counter_id, scale_ms, limit)</a>

      </div>

        <div class="summary-synopsis"><p>Retrieves data about a currently used counter without counting towards the limit.</p></div>

    </div>

</div>
<div class="summary-runtime summary">
  <h2>
    <a href="#runtime">Runtime</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_link/1" translate="no">start_link(opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Starts the rate limiter services.</p></div>

    </div>

</div>

  </section>


  <section id="rate-limiter" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#rate-limiter">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Rate Limiter
    </h1>
    <div class="rate-limiter-list">
<section class="detail" id="check_rate/4">

  <div class="detail-header">
    <a href="#check_rate/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">check_rate(counter_type, counter_id, scale_ms, limit)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> check_rate(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()
) ::
  {:allow, count :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
  | {:deny, limit :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
  | {:error, <a href="../../../../documentation/technical/app_server/mscmp_syst_error/MscmpSystError.html#t:t/0">MscmpSystError.t</a>()}</pre>

      </div>

<p>Checks if a Counter is within it's permissible rate and increments the Counter
if it is within it's permissible rate.</p><h2 id="check_rate/4-parameters" class="section-heading">
  <a href="#check_rate/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter for which the
rate is being checked.</p></li><li><p><code class="inline">counter_id</code> - the specific Counter ID of the type.  For example if the
<code class="inline">counter_type</code> is <code class="inline">:user_login</code>, the <code class="inline">counter_id</code> value may be a value like
<code class="inline">user@email.domain</code> for the user's username.</p></li><li><p><code class="inline">scale_ms</code> - the time in milliseconds of the rate window.  For example,
for the rate limit of 3 tries in one minute the <code class="inline">scale_ms</code> value is set to
60,000 milliseconds for one minute.</p></li><li><p><code class="inline">limit</code> - the number of attempts allowed with the <code class="inline">scale_ms</code> duration.  In
the example of 3 tries in one minute, the <code class="inline">limit</code> value is 3.</p></li></ul><h2 id="check_rate/4-example" class="section-heading">
  <a href="#check_rate/4-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">example</p>
  </a>
  Example
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="6434137009-1">(</span><span class="ss">:check_rate_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-1">)</span><span class="w">
</span><span class="p" data-group-id="6434137009-2">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6434137009-2">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="6434137009-3">(</span><span class="ss">:check_rate_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-3">)</span><span class="w">
</span><span class="p" data-group-id="6434137009-4">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6434137009-4">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="6434137009-5">(</span><span class="ss">:check_rate_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-5">)</span><span class="w">
</span><span class="p" data-group-id="6434137009-6">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-6">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="6434137009-7">(</span><span class="ss">:check_rate_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-7">)</span><span class="w">
</span><span class="p" data-group-id="6434137009-8">{</span><span class="ss">:deny</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6434137009-8">}</span></code></pre>
  </section>
</section>
<section class="detail" id="check_rate_with_increment/5">

  <div class="detail-header">
    <a href="#check_rate_with_increment/5" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">check_rate_with_increment(counter_type, counter_id, scale_ms, limit, increment)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> check_rate_with_increment(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()
) ::
  {:allow, count :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
  | {:deny, limit :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
  | {:error, <a href="../../../../documentation/technical/app_server/mscmp_syst_error/MscmpSystError.html#t:t/0">MscmpSystError.t</a>()}</pre>

      </div>

<p>Checks the rate same as <a href="#check_rate/4"><code class="inline">MscmpSystLimiter.check_rate/4</code></a>, but allows for a
variable increment to be set for the call.</p><h2 id="check_rate_with_increment/5-parameters" class="section-heading">
  <a href="#check_rate_with_increment/5-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter for which the
rate is being checked.</p></li><li><p><code class="inline">counter_id</code> - the specific Counter ID of the type.  For example if the
<code class="inline">counter_type</code> is <code class="inline">:user_login</code>, the <code class="inline">counter_id</code> value may be a value like
<code class="inline">user@email.domain</code> for the user's username.</p></li><li><p><code class="inline">scale_ms</code> - the time in milliseconds of the rate window.  For example,
for the rate limit of 3 tries in one minute the <code class="inline">scale_ms</code> value is set to
60,000 milliseconds for one minute.</p></li><li><p><code class="inline">limit</code> - the number of attempts allowed with the <code class="inline">scale_ms</code> duration.  In
the example of 3 tries in one minute, the <code class="inline">limit</code> value is 3.</p></li></ul><h2 id="check_rate_with_increment/5-example" class="section-heading">
  <a href="#check_rate_with_increment/5-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">example</p>
  </a>
  Example
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate_with_increment</span><span class="p" data-group-id="8046152586-1">(</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">:check_with_increment</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">60_000</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">10</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">7</span><span class="p" data-group-id="8046152586-1">)</span><span class="w">
</span><span class="p" data-group-id="8046152586-2">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p" data-group-id="8046152586-2">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate_with_increment</span><span class="p" data-group-id="8046152586-3">(</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">:check_with_increment</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">60_000</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">10</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">2</span><span class="p" data-group-id="8046152586-3">)</span><span class="w">
</span><span class="p" data-group-id="8046152586-4">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p" data-group-id="8046152586-4">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="8046152586-5">(</span><span class="ss">:check_with_increment</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="8046152586-5">)</span><span class="w">
</span><span class="p" data-group-id="8046152586-6">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="8046152586-6">}</span></code></pre>
  </section>
</section>
<section class="detail" id="delete_counters/2">

  <div class="detail-header">
    <a href="#delete_counters/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_counters(counter_type, counter_id)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete_counters(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>()
) ::
  {:ok, <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()} | {:error, <a href="../../../../documentation/technical/app_server/mscmp_syst_error/MscmpSystError.html#t:t/0">MscmpSystError.t</a>()}</pre>

      </div>

<p>Deletes a counter from the system.</p><h2 id="delete_counters/2-parameters" class="section-heading">
  <a href="#delete_counters/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter which is to be
deleted.</p></li><li><p><code class="inline">counter_id</code> - the specific Counter ID of the type.  For example if the
<code class="inline">counter_type</code> is <code class="inline">:user_login</code>, the <code class="inline">counter_id</code> value may be a value like
<code class="inline">user@email.domain</code> for the user's username.</p></li></ul><h2 id="delete_counters/2-example" class="section-heading">
  <a href="#delete_counters/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">example</p>
  </a>
  Example
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="6087348058-1">(</span><span class="ss">:delete_test_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60_000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6087348058-1">)</span><span class="w">
</span><span class="p" data-group-id="6087348058-2">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6087348058-2">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">delete_counters</span><span class="p" data-group-id="6087348058-3">(</span><span class="ss">:delete_test_counter</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id1&quot;</span><span class="p" data-group-id="6087348058-3">)</span><span class="w">
</span><span class="p" data-group-id="6087348058-4">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6087348058-4">}</span></code></pre>
  </section>
</section>
<section class="detail" id="get_check_rate_function/3">

  <div class="detail-header">
    <a href="#get_check_rate_function/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_check_rate_function(counter_type, scale_ms, limit)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_check_rate_function(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()
) ::
  (counter_id :: <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>() -&gt;
     {:allow, count :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
     | {:deny, limit :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()}
     | {:error, <a href="../../../../documentation/technical/app_server/mscmp_syst_error/MscmpSystError.html#t:t/0">MscmpSystError.t</a>()})</pre>

      </div>

<p>Returns an anonymous function to simplify calls to check the rate for a
specific counter type.</p><p>The returned function avoids requiring the parameters that are common between
calls from being constantly supplied.  The only parameter that the returned
function requires is the <code class="inline">counter_id</code> value of the specific counter of the
type to test; all other parameters typically required by
<a href="#check_rate/4"><code class="inline">MscmpSystLimiter.check_rate/4</code></a> are captured by the returned closure.</p><h2 id="get_check_rate_function/3-parameters" class="section-heading">
  <a href="#get_check_rate_function/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter that the
returned function will be set to check.</p></li><li><p><code class="inline">scale_ms</code> - the time in milliseconds of the rate window.  For example,
for the rate limit of 3 tries in one minute the <code class="inline">scale_ms</code> value is set to
60,000 milliseconds for one minute.</p></li><li><p><code class="inline">limit</code> - the number of attempts allowed with the <code class="inline">scale_ms</code> duration.  In
the example of 3 tries in one minute, the <code class="inline">limit</code> value is 3.</p></li></ul><h2 id="get_check_rate_function/3-example" class="section-heading">
  <a href="#get_check_rate_function/3-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">example</p>
  </a>
  Example
</h2>
<p>Note that The returned anonymous function is equivalent to making a call to
the more verbose <a href="#check_rate/4"><code class="inline">MscmpSystLimiter.check_rate/4</code></a>:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">my_check_rate_function</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">get_check_rate_function</span><span class="p" data-group-id="9449964623-1">(</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">    </span><span class="ss">:example_counter_get_func</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">    </span><span class="mi">60_000</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">    </span><span class="mi">3</span><span class="p" data-group-id="9449964623-1">)</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">my_check_rate_function</span><span class="o">.</span><span class="p" data-group-id="9449964623-2">(</span><span class="s">&quot;id1&quot;</span><span class="p" data-group-id="9449964623-2">)</span><span class="w">
</span><span class="p" data-group-id="9449964623-3">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9449964623-3">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">check_rate</span><span class="p" data-group-id="9449964623-4">(</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="ss">:example_counter_get_func</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="s">&quot;id1&quot;</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">60_000</span><span class="p">,</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="w">  </span><span class="mi">3</span><span class="p" data-group-id="9449964623-4">)</span><span class="w">
</span><span class="p" data-group-id="9449964623-5">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9449964623-5">}</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="n">my_check_rate_function</span><span class="o">.</span><span class="p" data-group-id="9449964623-6">(</span><span class="s">&quot;id1&quot;</span><span class="p" data-group-id="9449964623-6">)</span><span class="w">
</span><span class="p" data-group-id="9449964623-7">{</span><span class="ss">:allow</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9449964623-7">}</span></code></pre>
  </section>
</section>
<section class="detail" id="get_counter_name/2">

  <div class="detail-header">
    <a href="#get_counter_name/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_counter_name(counter_type, counter_id)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_counter_name(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>()
) ::
  <a href="MscmpSystLimiter.Types.html#t:counter_name/0">MscmpSystLimiter.Types.counter_name</a>()</pre>

      </div>

<p>Creates a canonical name for each unique counter.</p><h2 id="get_counter_name/2-parameters" class="section-heading">
  <a href="#get_counter_name/2-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter being created.</p></li><li><p><code class="inline">counter_id</code> - a value unique to the <code class="inline">counter_type</code> which identifies a
specific counter.</p></li></ul><h2 id="get_counter_name/2-example" class="section-heading">
  <a href="#get_counter_name/2-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">example</p>
  </a>
  Example
</h2>
<pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MscmpSystLimiter</span><span class="o">.</span><span class="n">get_counter_name</span><span class="p" data-group-id="7977268952-1">(</span><span class="ss">:example_counter_name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p" data-group-id="7977268952-1">)</span><span class="w">
</span><span class="s">&quot;example_counter_name_123&quot;</span></code></pre>
  </section>
</section>
<section class="detail" id="inspect_counter/4">

  <div class="detail-header">
    <a href="#inspect_counter/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">inspect_counter(counter_type, counter_id, scale_ms, limit)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> inspect_counter(
  <a href="MscmpSystLimiter.Types.html#t:counter_type/0">MscmpSystLimiter.Types.counter_type</a>(),
  <a href="MscmpSystLimiter.Types.html#t:counter_id/0">MscmpSystLimiter.Types.counter_id</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>()
) ::
  {:ok,
   {count :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(), count_remaining :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(),
    ms_to_next_counter :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>(), created_at :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>() | nil,
    updated_at :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">integer</a>() | nil}}
  | {:error, <a href="../../../../documentation/technical/app_server/mscmp_syst_error/MscmpSystError.html#t:t/0">MscmpSystError.t</a>()}</pre>

      </div>

<p>Retrieves data about a currently used counter without counting towards the limit.</p><h2 id="inspect_counter/4-parameters" class="section-heading">
  <a href="#inspect_counter/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">counter_type</code> - an atom representing the kind of counter which to inspect.</p></li><li><p><code class="inline">counter_id</code> - the specific Counter ID of the type.  For example if the
<code class="inline">counter_type</code> is <code class="inline">:user_login</code>, the <code class="inline">counter_id</code> value may be a value like
<code class="inline">user@email.domain</code> for the user's username.</p></li><li><p><code class="inline">scale_ms</code> - the time in milliseconds of the rate window.  For example,
for the rate limit of 3 tries in one minute the <code class="inline">scale_ms</code> value is set to
60,000 milliseconds for one minute.</p></li><li><p><code class="inline">limit</code> - the number of attempts allowed with the <code class="inline">scale_ms</code> duration.  In
the example of 3 tries in one minute, the <code class="inline">limit</code> value is 3.</p></li></ul>
  </section>
</section>

    </div>
  </section>

  <section id="runtime" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#runtime">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Runtime
    </h1>
    <div class="runtime-list">
<section class="detail" id="start_link/1">

    <span id="start_link/0"></span>

  <div class="detail-header">
    <a href="#start_link/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start_link(opts \\ [])</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> start_link(<a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="https://hexdocs.pm/elixir/Supervisor.html#t:on_start/0">Supervisor.on_start</a>()</pre>

      </div>

<p>Starts the rate limiter services.</p><p>This service should be started after the Mnesia has had its schema created.</p><h2 id="start_link/1-parameters" class="section-heading">
  <a href="#start_link/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><p><code class="inline">opts</code> - a Keyword List of options which can be used to override default
values typically used to initialize the service.  The available options are:</p><ul><li><p><code class="inline">supervisor_name</code> - the name of the supervisor which will manage the
Rate Limiter services.  The default value is <code class="inline">MscmpSystLimiter.Supervisor</code>.</p></li><li><p><code class="inline">expiry_ms</code> - the life time in milliseconds of any single Counter.  This
should be longer than the life of the longest bucket that will be created.
A shorter value could result in an active counter being deleted prior to
becoming inactive.</p></li><li><p><code class="inline">cleanup_interval_ms</code> - the time in milliseconds to wait between sweeps
of the stale Counter cleaner.  During a sweep any Counter past its expiry
time (see <code class="inline">expiry_ms</code>) will be purged from the system.</p></li><li><p><code class="inline">table_name</code> - the name of the backend database table to use for
tracking counters.  Typically this value should be allowed to default
(<code class="inline">:mscmp_syst_limiter_counters</code>) unless there's a compelling reason to do
otherwise.</p></li><li><p><code class="inline">mnesia_table_args</code> - a list of options to be passed directly to
<a href="https://www.erlang.org/doc/man/mnesia.html#create_table-2"><code class="inline">:mnesia.create_table/2</code></a>.  For complete documentation of the
available Mnesia table options see
<a href="https://www.erlang.org/doc/man/mnesia.html#create_table-2">the Erlang documentation</a>.</p></li></ul></li></ul>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="mscmp_syst_limiter.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
