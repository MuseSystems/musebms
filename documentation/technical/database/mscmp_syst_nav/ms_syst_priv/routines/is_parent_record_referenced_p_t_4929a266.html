<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>mscmp_syst_nav.ms_syst_priv</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <link rel="icon" type="image/png" sizes="16x16" href="../favicon.png">
        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="../bower/admin-lte/bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="../bower/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="../bower/ionicons/css/ionicons.min.css">
        <!-- DataTables -->
        <link rel="stylesheet" href="../bower/datatables.net-bs/css/dataTables.bootstrap.min.css">
        <link rel="stylesheet" href="../bower/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">
        <!-- Code Mirror -->
        <link rel="stylesheet" href="../bower/codemirror/codemirror.css">
        <!-- Fonts -->
        <link href='../fonts/indieflower/indie-flower.css' rel='stylesheet' type='text/css'>
        <link href='../fonts/source-sans-pro/source-sans-pro.css' rel='stylesheet' type='text/css'>

        <!-- Theme style -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/AdminLTE.min.css">
        <!-- Salvattore -->
        <link rel="stylesheet" href="../bower/salvattore/salvattore.css">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
           folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="../bower/admin-lte/dist/css/skins/_all-skins.min.css">
        <!-- SchemaSpy -->
        <link rel="stylesheet" href="../schemaSpy.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="../bower/html5shiv/html5shiv.min.js"></script>
        <script src="../bower/respond/respond.min.js"></script>
        <![endif]-->
    </head>
    <!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->
    <body class="hold-transition skin-blue layout-top-nav">
        <div class="wrapper">
            <header class="main-header">
                <nav class="navbar navbar-static-top">
                    <div class="container">
                        <div class="navbar-header">
                            <a href="../../index.html" class="navbar-brand"><b>mscmp_syst_nav</b></a><span class="navbar-brand" style="padding-left: 0">.ms_syst_priv</span>
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"><i class="fa fa-bars"></i></button>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li><a href="../index.html">Tables <span class="sr-only">(current)</span></a></li>
                                <li><a href="../columns.html" title="All of the columns in the schema">Columns</a></li>
                                <li><a href="../constraints.html" title="Useful for diagnosing error messages that just give constraint name or number">Constraints</a></li>
                                <li><a href="../relationships.html" title="Diagram of table relationships">Relationships</a></li>
                                <li><a href="../orphans.html" title="View of tables with neither parents nor children">Orphan&nbsp;Tables</a></li>
                                <li><a href="../anomalies.html" title="Things that might not be quite right">Anomalies</a></li>
                                <li><a href="../routines.html" title="Procedures and functions">Routines</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                        <!-- Navbar Right Menu -->
                    </div>
                    <!-- /.container-fluid -->
                </nav>
            </header>
            <!-- Main content -->
            <!-- Full Width Column -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>is_parent_record_referenced(p_table_schema text, p_table_name text, p_parent_record_id uuid, p_excluded_relations regclass[] DEFAULT &#39;{}&#39;::regclass[])</h1><br />
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-text-o"></i>
                            <h3 id="Description" class="box-title">Description</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body clearfix">
                            <p><p>Tests if a specific parent record is referenced in a foreign key relationship.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><strong><code>p_table_schema</code></strong> ::     <strong>Required?</strong> True; <strong>Default</strong>: ( No Default )</p>
<p>The name of the schema which hosts the parent table.</p>
</li>
<li>
<p><strong><code>p_table_name</code></strong> ::     <strong>Required?</strong> True; <strong>Default</strong>: ( No Default )</p>
<p>The name of the parent table.</p>
</li>
<li>
<p><strong><code>p_parent_record_id</code></strong> ::     <strong>Required?</strong> True; <strong>Default</strong>: ( No Default )</p>
<p>The ID value of the parent record which will be searched for in the child tables.</p>
</li>
<li>
<p><strong><code>p_excluded_relations</code></strong> ::     <strong>Required?</strong> False; <strong>Default</strong>: No excluded relations</p>
<p>An optional array of child table <code>regclass</code>es which should not be searched.</p>
</li>
</ul>
<p><strong>General Usage</strong></p>
<p>The parent table is identified by the <code>p_table_schema</code> and <code>p_table_name</code> parameters and the specific record is identified using the <code>p_parent_record_id</code> parameter.  The <code>p_parent_record_id</code> is expected to be the <code>id</code> column value of the parent relation.</p>
<p>On execution, the function will then look up all relations (children) with foreign key references to the parent table and its <code>id</code> column and test if the <code>p_parent_record_id</code> value exists in the child relation.  Once a child relation with a reference is found, then the function returns <code>TRUE</code> and the search stops. If no child relations have a reference to the given parent record, then the function returns false.</p>
<p>There are several assumptions to be aware of when making use of this function. The function assumes that any foreign key reference to the parent relation is a simple, single column relationship to the parent relation&rsquo;s <code>id</code> column;  an assumption is made that constraint names are unique across the application, but there is no guarantee from PostgreSQL that this is true; and that by using this function the developer is aware that when there are either many child relations and/or the child relations contain many records, this function may not perform well, especially in cases where there are no references to the given parent record.  Finally, if any of the parameter values are <code>NULL</code>, the function will return <code>NULL</code>.</p></p>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                            <h3 id="Columns" class="box-title">Parameters</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <table id="standard_table" class="table table-bordered table-striped dataTable" role="grid">
                                <thead align='left'>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Mode</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>p_table_schema</td>
                                    <td>text</td>
                                    <td>IN</td>
                                </tr>
                                <tr>
                                    <td>p_table_name</td>
                                    <td>text</td>
                                    <td>IN</td>
                                </tr>
                                <tr>
                                    <td>p_parent_record_id</td>
                                    <td>uuid</td>
                                    <td>IN</td>
                                </tr>
                                <tr>
                                    <td>p_excluded_relations</td>
                                    <td>regclass[]</td>
                                    <td>IN</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-file-code-o"></i>
                            <h3 id="RoutineDefinition" class="box-title">Definition</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <textarea id="sql-script-codemirror" name="sql-script-codemirror" rows="" style="display: none;">-- File:        is_parent_record_referenced.eex.sql&#10;-- Location:    musebms/database/all/ms_syst_priv/functions/is_parent_record_referenced.eex.sql&#10;-- Project:     Muse Systems Business Management System&#10;--&#10;-- Copyright Â© Lima Buttgereit Holdings LLC d/b/a Muse Systems&#10;-- This file may include content copyrighted and licensed from third parties.&#10;--&#10;-- See the LICENSE file in the project root for license terms and conditions.&#10;-- See the NOTICE file in the project root for copyright ownership information.&#10;--&#10;-- muse.information@musesystems.com :: https://muse.systems&#10;&#10;DECLARE&#10;    var_referencing_relation record;&#10;    var_check_result         boolean;&#10;&#10;BEGIN&#10;&#10;    IF&#10;           p_table_schema IS NULL&#10;        OR p_table_name IS NULL&#10;        OR p_parent_record_id IS NULL&#10;    THEN&#10;        RAISE EXCEPTION&#10;            USING&#10;                MESSAGE &#61; &#39;All parameters are required with valid, non-null &#39; ||&#10;                &#39;values.&#39;,&#10;                DETAIL &#61; ms_syst_priv.get_exception_details(&#10;                             p_proc_schema    &#61;&gt; &#39;ms_syst_priv&#39;&#10;                            ,p_proc_name      &#61;&gt; &#39;is_parent_record_referenced&#39;&#10;                            ,p_exception_name &#61;&gt; &#39;invalid_parameter&#39;&#10;                            ,p_errcode        &#61;&gt; &#39;PM008&#39;&#10;                            ,p_param_data     &#61;&gt;&#10;                                jsonb_build_object(&#10;                                     &#39;p_table_schema&#39;,       p_table_schema&#10;                                    ,&#39;p_table_name&#39;,         p_table_name&#10;                                    ,&#39;p_parent_record_id&#39;,   p_parent_record_id&#10;                                    ,&#39;p_excluded_relations&#39;, p_excluded_relations)&#10;                            ,p_context_data   &#61;&gt; null),&#10;                ERRCODE &#61; &#39;PM008&#39;;&#10;    END IF;&#10;&#10;    &lt;&lt; referencing_relations_loop &gt;&gt;&#10;    FOR var_referencing_relation IN&#10;        SELECT&#10;              kcu.table_schema&#10;            , kcu.table_name&#10;            , kcu.column_name&#10;        FROM information_schema.table_constraints tc&#10;            JOIN information_schema.constraint_column_usage ccu&#10;                ON  ccu.table_schema    &#61; tc.table_schema AND&#10;                    ccu.table_name      &#61; tc.table_name   AND&#10;                    ccu.constraint_name &#61; tc.constraint_name&#10;            JOIN information_schema.key_column_usage kcu&#10;                ON  kcu.constraint_name &#61; tc.constraint_name&#10;        WHERE   tc.constraint_type &#61; &#39;FOREIGN KEY&#39;&#10;            AND tc.table_schema    &#61; p_table_schema&#10;            AND tc.table_name      &#61; p_table_name&#10;            AND ccu.column_name    &#61; &#39;id&#39;&#10;            AND NOT to_regclass( kcu.table_schema || &#39;.&#39; || kcu.table_name ) &#61;&#10;                    ANY ( coalesce( p_excluded_relations, &#39;{}&#39;::regclass[] ) )&#10;    LOOP&#10;&#10;        EXECUTE format(&#10;            &#39;SELECT exists(SELECT TRUE FROM %1$I.%2$I WHERE %3$I &#61; (%4$L)::uuid)&#39;,&#10;            var_referencing_relation.table_schema,&#10;            var_referencing_relation.table_name,&#10;            var_referencing_relation.column_name,&#10;            p_parent_record_id)&#10;            INTO var_check_result;&#10;&#10;        IF var_check_result THEN&#10;            RETURN TRUE;&#10;        END IF;&#10;&#10;    END LOOP referencing_relations_loop;&#10;&#10;    RETURN FALSE;&#10;&#10;END;</textarea>
                        </div>
                    </div>
                </section>
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div>
                    <div class="pull-right hidden-xs">
                        <a href="https://github.com/schemaspy/schemaspy" title="GitHub for SchemaSpy"><i class="fa fa-github-square fa-2x"></i></a>
                        <a href="http://stackoverflow.com/questions/tagged/schemaspy" title="StackOverflow for SchemaSpy"><i class="fa fa-stack-overflow fa-2x"></i></a>
                    </div>
                    <strong>Generated by <a href="http://schemaspy.org/" class="logo-text"><i class="fa fa-database"></i> SchemaSpy 6.2.4</a></strong>
                </div>
                <!-- /.container -->
            </footer>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script src="../bower/admin-lte/plugins/jQuery/jquery-2.2.3.min.js"></script>
        <script src="../bower/admin-lte/plugins/jQueryUI/jquery-ui.min.js"></script>
        <!-- Bootstrap 3.3.5 -->
        <script src="../bower/admin-lte/bootstrap/js/bootstrap.min.js"></script>
        <!-- DataTables -->
        <script src="../bower/datatables.net/jquery.dataTables.min.js"></script>
        <script src="../bower/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/dataTables.buttons.min.js"></script>
        <script src="../bower/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.html5.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.print.min.js"></script>
        <script src="../bower/datatables.net-buttons/buttons.colVis.min.js"></script>
        <!-- SheetJS -->
        <script src="../bower/js-xlsx/xlsx.full.min.js"></script>
        <!-- pdfmake -->
        <script src="../bower/pdfmake/pdfmake.min.js"></script>
        <script src="../bower/pdfmake/vfs_fonts.js"></script>
        <!-- SlimScroll -->
        <script src="../bower/admin-lte/plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- FastClick -->
        <script src="../bower/admin-lte/plugins/fastclick/fastclick.js"></script>
        <!-- Salvattore -->
        <script src="../bower/salvattore/salvattore.min.js"></script>
        <!-- AnchorJS -->
        <script src="../bower/anchor-js/anchor.min.js"></script>
        <!-- CodeMirror -->
        <script src="../bower/codemirror/codemirror.js"></script>
        <script src="../bower/codemirror/sql.js"></script>
        <!-- AdminLTE App -->
        <script src="../bower/admin-lte/dist/js/app.min.js"></script>
        <script src="routine.js"></script>
        <script src="../schemaSpy.js"></script>
    </body>
</html>